# 更新日志 / Changelog

## v1.0.7 (2026-02-13)

### 🐛 问题修复
- **彻底修复配置页面错误** - 解决 `d.map is not a function` 错误
  - 使用 `any[]` 替代 `PluginConfigSchema` 类型
  - 移除 `NapCatConfig.combine()` 改为逐个 push 配置项
  - 移除 `select()` 改用 `text()` 配置项
  - 详见 [FIX_REPORT.md](./FIX_REPORT.md)

### ✅ 验证
- ✅ 插件可以正常启用
- ✅ 配置页面可以正常打开
- ✅ 所有配置项显示正常
- ✅ 可以修改配置并保存

## v1.0.6 (2026-02-13)

### 🔧 改进
- 移除 `select()` 改用 `text()` 配置项
- 简化配置 Schema 构建

## v1.0.5 (2026-02-13)

### 🔧 改进
- 修复配置 Schema 返回格式
- 改为直接返回数组而不是 combine 结果

## v1.0.2 (2026-02-13)

### ✨ 新增功能
- **多格式支持**：新增 EPUB 和 HTML 格式导出选项
- **详情查看**：添加 `小说详情 <ID>` 命令，查看书籍完整信息
- **美化卡片**：优化消息卡片显示，与 Koishi 插件风格一致
- **群主特权**：群主现在享有与管理员相同的无限制权限

### 🔧 改进优化
- **API 升级**：使用新的七猫 API 客户端，提升稳定性和速度
- **详细信息**：展示书名、作者、状态、字数、分类、简介等完整信息
- **消息美化**：所有消息输出采用统一的美化格式
- **进度优化**：改进下载进度显示，增加状态图标

### ❌ 功能删除
- **移除 VIP 系统**：众生平等，所有用户享受相同待遇
- **移除金币系统**：简化功能，专注下载体验
- **简化权限**：只保留管理员和群主特权，其他用户统一限制

### 🐛 问题修复
- 修复多处语法错误
- 修复权限检查逻辑
- 修复类型定义问题
- 更新依赖版本

### 📝 命令更新

```
搜索小说 <书名>          # 搜索小说
小说详情 <ID>            # 查看书籍详情（新增）
下载小说 <ID>            # 下载七猫小说
下载进度                 # 查看当前下载进度
取消下载                 # 取消当前下载任务
小说帮助                 # 查看帮助信息
```

### 📚 格式支持

| 格式 | 状态 | 说明 |
|------|------|------|
| TXT | ✅ 完整支持 | 纯文本格式，兼容性最好 |
| HTML | ✅ 完整支持 | 网页格式，支持样式美化 |
| EPUB | ⚠️ 开发中 | 电子书格式，暂时回退到 TXT |

## v1.0.1 (2026-02-13)

### 改进
- 👤 更新作者信息为 LANHU199

## v1.0.0 (2026-02-12)

### ✨ 新特性

#### 🎉 首次发布
- **七猫小说支持**：完整支持七猫小说的搜索与下载
- **高速下载**：采用高并发架构，下载速度可达 350 章/秒
- **智能搜索**：支持关键词搜索，快速定位目标小说
- **实时进度**：下载过程中实时显示进度、速度和预计剩余时间
- **群文件集成**：下载完成后自动上传到 QQ 群文件的"小说"文件夹

#### 🔐 权限管理系统
- **三级权限**：普通用户、VIP 用户、管理员分级管理
- **每日限制**：普通用户每日 5 次，VIP 用户每日 20 次
- **管理员特权**：管理员无下载限制
- **数据持久化**：用户数据自动保存，重启不丢失

#### 📊 任务管理
- **并发控制**：支持多用户同时下载，最大并发任务数可配置
- **进度查询**：随时查看当前下载任务的详细进度
- **任务取消**：支持随时取消正在进行的下载任务
- **断点续传**：下载中断后可继续（待完善）

#### ⚙️ 配置系统
- **WebUI 配置**：在 NapCat WebUI 中可视化配置所有参数
- **灵活设置**：支持自定义下载目录、并发数、限制次数等
- **热更新**：配置修改后立即生效，无需重启

### 📝 支持的命令

```
搜索小说 <书名>          # 搜索小说
下载小说 <ID>            # 下载七猫小说
下载进度                 # 查看当前下载进度
取消下载                 # 取消当前下载任务
小说帮助                 # 查看帮助信息
```

### 📚 支持的平台

| 平台 | 搜索 | 下载 | 格式 | 状态 |
|------|------|------|------|------|
| 七猫小说 | ✅ | ✅ | TXT | 完整支持 |

### 🛠️ 技术特性

- **TypeScript 编写**：完整的类型定义，代码质量高
- **模块化架构**：清晰的分层设计，易于维护和扩展
- **错误处理**：完善的错误处理机制，稳定可靠
- **日志系统**：详细的日志记录，便于调试和排查问题

### 📦 安装说明

#### 方式一：通过 NapCat WebUI 安装（推荐）
1. 打开 NapCat WebUI
2. 进入插件市场
3. 搜索"小说下载器"
4. 点击安装

#### 方式二：手动安装
1. 下载 `napcat-plugin-novel-downloader.zip`
2. 解压到 NapCat 的 `plugins` 目录
3. 重启 NapCat
4. 在 WebUI 中配置插件

### ⚙️ 配置建议

```json
{
  "enabled": true,
  "adminQQ": ["你的QQ号"],
  "dailyLimit": 5,
  "vipDailyLimit": 20,
  "maxChapterLimit": 500,
  "downloadDir": "./novels",
  "maxConcurrentTasks": 3,
  "apiConcurrency": 350,
  "debug": false
}
```

### 👤 作者

**LANHU199**

### 🙏 鸣谢

本项目在开发过程中参考了以下开源项目：

- **[swiftcat-downloader-flutter](https://github.com/shing-yu/swiftcat-downloader-flutter)** - 七猫小说下载器
  - 提供了七猫小说 API 的实现思路和参考代码
  - 感谢 @shing-yu 的开源贡献

### 📖 使用示例

#### 搜索小说
```
用户: 搜索小说 斗破苍穹
机器人: 📚 搜索结果 (共3个):

1. 斗破苍穹
   作者: 天蚕土豆
   来源: 七猫
   状态: 完结
   ID: 123456

💡 发送 "下载小说 书籍ID" 开始下载
```

#### 下载小说
```
用户: 下载小说 123456
机器人: 📥 正在准备下载...
机器人: ✅ 下载完成！
📚 1234 章节
⏱️ 用时 45秒
```

### 🐛 已知问题

- EPUB 格式导出功能尚未实现
- 下载历史记录功能待开发
- 部分小说可能因平台限制无法下载

### 🔮 后续计划

- [ ] 支持 EPUB 格式导出
- [ ] 添加下载历史记录
- [ ] 实现书籍收藏功能
- [ ] 优化下载速度
- [ ] 添加更多小说平台支持

### 📄 许可证

MIT License

### 🔗 相关链接

- **项目主页**: [GitHub Repository](https://github.com/wuxiang999/napcat-plugin-novel-downloader)
- **问题反馈**: [Issues](https://github.com/wuxiang999/napcat-plugin-novel-downloader/issues)
- **使用文档**: [USAGE.md](./USAGE.md)
- **开发文档**: [项目说明.md](./项目说明.md)

### 💬 反馈与支持

如有问题或建议，欢迎：
- 提交 [Issue](https://github.com/wuxiang999/napcat-plugin-novel-downloader/issues)
- 发起 [Pull Request](https://github.com/wuxiang999/napcat-plugin-novel-downloader/pulls)
- 加入讨论群（待建立）

---

**感谢使用 NapCat 小说下载插件！** 📚✨
