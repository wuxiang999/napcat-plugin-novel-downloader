# v1.0.2 - 功能增强与体验优化

## 🎉 重大更新

本次更新带来了多项重要功能和体验优化，让小说下载更加便捷和美观！

## ✨ 新增功能

### 📄 多格式支持
- **TXT 格式**：经典纯文本格式，兼容性最好
- **HTML 格式**：精美网页格式，支持样式美化
- **EPUB 格式**：电子书格式（开发中，暂时回退到 TXT）

在 WebUI 配置中可以选择输出格式，满足不同阅读需求。

### 📖 详情查看命令
新增 `小说详情 <ID>` 命令，可以在下载前查看书籍的完整信息：
- 书名和作者
- 连载状态
- 字数统计
- 分类标签
- 内容简介

### 🎨 美化消息卡片
所有消息输出都经过精心设计，采用统一的美化格式：
```
━━━━━━━━━━━━━━━━━━
📚 斗破苍穹
━━━━━━━━━━━━━━━━━━

✍️ 作者: 天蚕土豆
📖 来源: 七猫
📊 状态: 已完结
📝 字数: 523.5万字
🏷️ 分类: 玄幻, 热血

📄 简介:
这里是斗气的世界，没有花俏艳丽的魔法...

━━━━━━━━━━━━━━━━━━
💡 发送 "下载小说 123456" 开始下载
```

### 👑 群主特权
群主现在享有与管理员相同的无限制权限，无需配置即可无限下载。

## 🔧 改进优化

### API 升级
- 使用全新的七猫 API 客户端
- 基于 swiftcat-downloader-flutter 的最新实现
- 提升下载稳定性和成功率
- 优化请求签名算法

### 详细信息展示
下载时会先展示书籍详情卡片，让用户确认信息：
- 完整的书籍元数据
- 清晰的状态提示
- 美观的排版布局

### 进度显示优化
- 添加状态图标（⏳ ⬇️ ✅ ❌ 等）
- 优化进度条显示
- 改进速度和时间估算

## ❌ 功能删除

### 移除 VIP 系统
为了简化功能和提升用户体验，我们移除了 VIP 系统：
- 所有普通用户享受相同待遇
- 统一的每日下载限制
- 管理员和群主无限制

### 移除金币系统
专注于核心下载功能，移除了金币系统：
- 无需积累金币
- 无需兑换 VIP
- 更简单直接的使用体验

## 🐛 问题修复

- 修复多处 TypeScript 语法错误
- 修复权限检查逻辑问题
- 修复类型定义不完整的问题
- 更新过时的依赖版本
- 优化错误处理机制

## 📝 命令列表

```
搜索小说 <书名>          # 搜索小说
小说详情 <ID>            # 查看书籍详情（新增）
下载小说 <ID>            # 下载七猫小说
下载进度                 # 查看当前下载进度
取消下载                 # 取消当前下载任务
小说帮助                 # 查看帮助信息
```

## 📚 支持的格式

| 格式 | 状态 | 说明 |
|------|------|------|
| TXT | ✅ 完整支持 | 纯文本格式，兼容性最好 |
| HTML | ✅ 完整支持 | 网页格式，支持样式美化 |
| EPUB | ⚠️ 开发中 | 电子书格式，暂时回退到 TXT |

## 🎯 权限说明

- **管理员**：无下载限制（需在配置中设置 QQ 号）
- **群主**：无下载限制（自动识别）
- **普通用户**：每日限制 5 次（可在配置中调整）

## 📦 安装说明

### 自动更新
如果你已经安装了旧版本，NapCat 会自动检测并提示更新。

### 手动安装
1. 下载 `napcat-plugin-novel-downloader.zip`
2. 解压到 NapCat 的 `plugins` 目录
3. 重启 NapCat
4. 在 WebUI 中配置输出格式

## ⚙️ 配置建议

```json
{
  "enabled": true,
  "adminQQ": ["你的QQ号"],
  "dailyLimit": 5,
  "maxChapterLimit": 500,
  "downloadDir": "./novels",
  "maxConcurrentTasks": 3,
  "apiConcurrency": 350,
  "outputFormat": "txt",
  "debug": false
}
```

## 🙏 鸣谢

感谢 [swiftcat-downloader-flutter](https://github.com/shing-yu/swiftcat-downloader-flutter) 项目提供的七猫小说 API 实现参考。

## 📖 使用示例

### 搜索小说
```
用户: 搜索小说 斗破苍穹
机器人: 📚 搜索结果 (共3个):

1. 斗破苍穹
   作者: 天蚕土豆
   状态: 已完结
   ID: 123456

💡 发送 "下载小说 书籍ID" 开始下载
```

### 查看详情
```
用户: 小说详情 123456
机器人: ━━━━━━━━━━━━━━━━━━
📚 斗破苍穹
━━━━━━━━━━━━━━━━━━

✍️ 作者: 天蚕土豆
📖 来源: 七猫
📊 状态: 已完结
📝 字数: 523.5万字
🏷️ 分类: 玄幻, 热血

📄 简介:
这里是斗气的世界，没有花俏艳丽的魔法...

━━━━━━━━━━━━━━━━━━
💡 发送 "下载小说 123456" 开始下载
```

### 下载小说
```
用户: 下载小说 123456
机器人: ━━━━━━━━━━━━━━━━━━
📚 斗破苍穹
━━━━━━━━━━━━━━━━━━

✍️ 作者: 天蚕土豆
📖 来源: 七猫
📊 状态: 已完结
📝 字数: 523.5万字

📥 开始下载中，请稍候...
━━━━━━━━━━━━━━━━━━

机器人: ✅ 下载完成！

📚 书名: 斗破苍穹
✍️ 作者: 天蚕土豆
📖 章节: 1234 章
⏱️ 用时: 45秒
📁 格式: TXT
```

## 🔮 后续计划

- [ ] 完善 EPUB 格式导出
- [ ] 添加下载历史记录
- [ ] 实现书籍收藏功能
- [ ] 支持更多小说平台
- [ ] 优化下载速度

## 💬 反馈与支持

如有问题或建议，欢迎：
- 提交 [Issue](https://github.com/wuxiang999/napcat-plugin-novel-downloader/issues)
- 发起 [Pull Request](https://github.com/wuxiang999/napcat-plugin-novel-downloader/pulls)

---

**感谢使用 NapCat 小说下载插件！** 📚✨
