# 使用文档

本文档详细介绍 NapCat 小说下载插件的使用方法。

## 📋 目录

- [安装](#安装)
- [配置](#配置)
- [命令使用](#命令使用)
- [权限系统](#权限系统)
- [常见问题](#常见问题)

## 安装

### 通过 WebUI 安装（推荐）

1. 打开 NapCat WebUI（默认地址：http://localhost:6099）
2. 点击左侧菜单的"插件市场"
3. 搜索"小说下载器"
4. 点击"安装"按钮
5. 等待安装完成后，在"已安装插件"中找到并启用

### 手动安装

```bash
# 1. 下载插件
wget https://github.com/wuxiang999/napcat-plugin-novel-downloader/releases/latest/download/napcat-plugin-novel-downloader.zip

# 2. 解压到插件目录
unzip napcat-plugin-novel-downloader.zip -d /path/to/napcat/plugins/napcat-plugin-novel-downloader/

# 3. 重启 NapCat
```

## 配置

在 NapCat WebUI 中配置插件：

### 基础配置

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| enabled | boolean | true | 是否启用插件 |
| debug | boolean | false | 是否开启调试模式 |

### 权限配置

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| adminQQ | string[] | [] | 管理员QQ号列表 |
| dailyLimit | number | 5 | 普通用户每日下载次数 |
| vipDailyLimit | number | 20 | VIP用户每日下载次数 |
| maxChapterLimit | number | 500 | 单本小说最大章节数限制 |

### 下载配置

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| downloadDir | string | ./novels | 小说保存目录 |
| maxConcurrentTasks | number | 3 | 最大并发下载任务数 |
| apiConcurrency | number | 350 | 单任务API并发数 |

### 配置示例

```json
{
  "enabled": true,
  "adminQQ": ["123456789"],
  "dailyLimit": 5,
  "vipDailyLimit": 20,
  "maxChapterLimit": 500,
  "downloadDir": "./novels",
  "maxConcurrentTasks": 3,
  "apiConcurrency": 350,
  "debug": false
}
```

## 命令使用

### 搜索小说

**命令格式**：`搜索小说 <关键词>` 或 `搜小说 <关键词>`

**示例**：
```
用户: 搜索小说 斗破苍穹

机器人: 📚 搜索结果 (共3个):

1. 斗破苍穹
   作者: 天蚕土豆
   来源: 七猫
   状态: 完结
   ID: 123456

2. 斗破苍穹之无上之境
   作者: 夜雨闻铃0
   来源: 七猫
   状态: 连载
   ID: 789012

💡 发送 "下载小说 书籍ID" 开始下载
```

### 下载小说

**命令格式**：`下载小说 <书籍ID>` 或 `下小说 <书籍ID>`

**示例**：
```
用户: 下载小说 123456

机器人: 📥 正在准备下载...

机器人: 📊 下载进度
📚 书名: 斗破苍穹
✍️ 作者: 天蚕土豆
📈 进度: 856/1234 (69.4%)
⚡ 速度: 19.0 章/秒
⏱️ 预计剩余: 20秒

机器人: ✅ 下载完成！
📚 1234 章节
⏱️ 用时 65秒
📁 已上传到群文件
```

### 查看进度

**命令格式**：`下载进度` 或 `进度`

**示例**：
```
用户: 下载进度

机器人: 📊 下载进度

📚 书名: 斗破苍穹
✍️ 作者: 天蚕土豆
📈 进度: 856/1234 (69.4%)
⚡ 速度: 19.0 章/秒
⏱️ 预计剩余: 20秒
📊 状态: 下载中
```

### 取消下载

**命令格式**：`取消下载` 或 `停止下载`

**示例**：
```
用户: 取消下载

机器人: ✅ 已取消下载
```

### 查看帮助

**命令格式**：`小说帮助` 或 `小说菜单`

**示例**：
```
用户: 小说帮助

机器人: 📚 小说下载插件

🔍 搜索小说 <书名> - 搜索小说
📥 下载小说 <ID> - 下载小说
📊 下载进度 - 查看进度
❌ 取消下载 - 取消任务

支持平台: 七猫
```

## 权限系统

### 权限等级

1. **普通用户**
   - 每日下载限制：5次
   - 章节数限制：500章

2. **VIP 用户**
   - 每日下载限制：20次
   - 章节数限制：500章

3. **管理员**
   - 无下载次数限制
   - 无章节数限制

### 设置管理员

在配置中添加管理员QQ号：

```json
{
  "adminQQ": ["123456789", "987654321"]
}
```

### 设置 VIP 用户

VIP 功能待实现，当前版本暂不支持。

## 常见问题

### Q: 下载失败怎么办？

A: 请检查：
1. 书籍ID是否正确
2. 网络连接是否正常
3. 是否超过每日下载限制
4. 查看日志获取详细错误信息

### Q: 如何提高下载速度？

A: 可以调整以下配置：
- 增加 `apiConcurrency`（建议不超过500）
- 确保网络带宽充足
- 减少其他并发任务

### Q: 下载的文件保存在哪里？

A: 默认保存在 `./novels` 目录，可通过 `downloadDir` 配置修改。

### Q: 支持哪些小说平台？

A: 当前版本仅支持七猫小说平台。

### Q: 如何查看下载历史？

A: 下载历史功能待开发，敬请期待。

### Q: 可以导出为 EPUB 格式吗？

A: EPUB 格式导出功能待开发，当前仅支持 TXT 格式。

## 🐛 问题反馈

如遇到问题，请：

1. 开启调试模式：`debug: true`
2. 查看日志输出
3. 在 [Issues](https://github.com/wuxiang999/napcat-plugin-novel-downloader/issues) 中反馈

## 📚 更多资源

- [项目主页](https://github.com/wuxiang999/napcat-plugin-novel-downloader)
- [更新日志](./CHANGELOG.md)
- [贡献指南](./CONTRIBUTING.md)

---

**需要帮助？欢迎提 Issue！**
